<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuevo Producto</title>
    <link rel="stylesheet" href="/styles/new-product.css">
    <link rel="stylesheet" href="/styles/navbar.css">
</head>

<body>
    <header>
        <%- include('partials/navbar') %>
    </header>
    <main>
        <div class="div-form">
            <h1>Agregar Nuevo Producto</h1>
            <form action="/products" method="POST" class="product-form">
                <div class="form-group">
                    <label for="name">Nombre del Producto</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="description">Descripción</label>
                    <textarea id="description" name="description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="price">Precio</label>
                    <input type="number" id="price" name="price" step="0.50" required>
                </div>
                <div class="form-group">
                    <label for="stock">Stock</label>
                    <input type="number" id="stock" name="stock" required>
                </div>
                <div class="form-group">
                    <label for="discount">Descuento</label>
                    <input type="number" id="discount" name="discount" step="0.10" max="1">
                </div>
                <div class="form-group">
                    <label for="disabled">Disabled</label>
                    <input type="checkbox" id="disabled" name="disabled">
                </div>
                <button type="submit" class="submit-button">Agregar Producto</button>
            </form>
        </div>
        <script>
            const form = document.querySelector('.product-form');
            form.addEventListener('submit', async (event) => {
                event.preventDefault();
                const jsonData = {
                    name: form.name.value,
                    description: form.description.value,
                    price: Number(form.price.value),
                    stock: Number(form.stock.value, 10),
                    discount: form.discount.value ? Number(form.discount.value) : undefined,
                    disabled: form.disabled.checked
                }

                console.log(jsonData);
                const response = await fetch('/products/new', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData)
                });
                if (response.ok) {
                    alert('Producto agregado exitosamente');
                    form.reset();
                } else {
                    const data = await response.json();
                    console.log(data);
                    
                    alert('Ocurrió un error al agregar el producto');
                }
            });
        </script>
    </main>
</body>

</html>